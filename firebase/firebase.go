package main

import (
	"bytes"
	"flag"
	"fmt"
	"io/ioutil"
	"net/http"
	"strings"
)

func main() {
	fmt.Println("Author: Nullfil3")
	var appID = flag.String("appid", "", "==> appid Ex: 1:76574648764:web:786sd786a")
	var googleAPIKey = flag.String("gapikey", "", "==> Google api key  Ex:AizAaa")
	var projectID = flag.String("projectid", "", "==> projectid Ex: cdn-prd")
	var firebURL = flag.String("url", "", "==> firebase url Ex: myfirebase.firebase.io")
	flag.Parse()

	if *appID != "" || *googleAPIKey != "" || *projectID != "" {
		fmt.Println("==> Projectid: ", *projectID)
		sliceappID := strings.Split(*appID, ":")[1]
		firebaseURL := "https://firebaseremoteconfig.googleapis.com/v1/projects/" + sliceappID + "/namespaces/firebase:fetch?key=" + *googleAPIKey

		fmt.Printf("==> Requesting to: %s\n", firebaseURL)

		jsonBody := "{\"appId\":\"" + *appID + "\",\"appInstanceId\":\"required_but_unused_value\"}"
		jsonBodyBytes := []byte(jsonBody)

		req, err := http.NewRequest("POST", firebaseURL, bytes.NewBuffer(jsonBodyBytes))
		req.Header.Set("Content-type", "application/json")
		req.Header.Set("User-Agent", "https://github.com/Nullfil3")

		cli := &http.Client{}
		resp, err := cli.Do(req)

		if err != nil {
			panic(err)
		}

		defer resp.Body.Close()
		fmt.Println("==> response Status: " + resp.Status)
		body, err := ioutil.ReadAll(resp.Body)
		if err != nil {
			fmt.Println("==> Erro print the body of response..")
			panic(err)
		}

		fmt.Println("==> Response Body: ", string(body))
	}

	if *firebURL != "" {
		URLreq := *firebURL + "/.json"

		reqFire, err := http.NewRequest("GET", URLreq, nil)
		reqFire.Header.Set("User-Agent", "https://github.com/Nullfil3")
		cliFire := http.Client{}
		respFire, err := cliFire.Do(reqFire)
		if err != nil {
			fmt.Println("==> Something went wrong to request: ", URLreq)
			panic(err)
		}
		fmt.Println("==> Status code from: ", respFire.StatusCode)
		bodyResp, err := ioutil.ReadAll(respFire.Body)
		if err != nil {
			fmt.Println("==> erro while get response from: ", URLreq)
			fmt.Println("==> Status code: ", respFire.StatusCode)
			panic(err)
		}

		defer respFire.Body.Close()
		fmt.Println("==> DATA: ", string(bodyResp))
	}

}
